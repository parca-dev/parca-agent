name: "Cargo Audit"

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '28 16 * * 3'

env:
  # renovate: datasource=crate depName=cargo-audit versioning=cargo
  CARGO_AUDIT_VERSION: =0.17.0

jobs:
  audit:
    name: Audit
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8 # tag=v3.1.0

      - name: Set up Rust
        run: rustup show

      - name: Rust cache
        uses: Swatinem/rust-cache@6720f05bc48b77f96918929a9019fb2203ff71f8 # tag=v2.0.0
        with:
          workspaces: bpf -> target

      - name: Set up cargo-audit
        run: cargo install --locked cargo-audit --version "${CARGO_AUDIT_VERSION}"

      - name: Audit
        run: cd bpf && cargo audit --deny warnings
